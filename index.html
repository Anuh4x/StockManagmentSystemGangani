<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spare Part Stock Management</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #f5f7fa; color: #333; }

    .top-bar {
      width: 100%;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.6);
      backdrop-filter: blur(10px);
      position: fixed;
      top: 0; left: 0;
      z-index: 1000;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }

    .btn {
      padding: 10px 20px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    .container { padding: 100px 20px 40px; max-width: 1100px; margin: auto; }

    .glass-card {
      background: rgba(255,255,255,0.55);
      backdrop-filter: blur(12px);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }

    /* Popup */
    .popup-bg {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
    }

    .popup {
      width: 90%; max-width: 400px;
      background: rgba(255,255,255,0.75);
      backdrop-filter: blur(15px);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 4px 25px rgba(0,0,0,0.2);
    }

    input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #bbb; margin-top: 10px; }

    .btn-row { display: flex; gap: 10px; margin-top: 15px; }
    .cancel-btn { background: #888; }
  </style>
</head>

<body>

  <div class="top-bar">
    <div class="logo" style="font-size:1.4rem; font-weight:bold;">Gangani Auto Electricals</div>
    <button class="btn" onclick="openPopup()">Add Item</button>
  </div>

  <div class="container">
    <div class="glass-card">
      <h2>Search Stock</h2>
      <input type="text" id="searchInput" placeholder="Search part name or number..." onkeyup="filterStock()" />

      <table>
        <thead>
          <tr>
            <th>Part No.</th>
            <th>Part Name</th>
            <th>Vehicle</th>
            <th>Stock</th>
            <th>Buy Price</th>
            <th>Sell Price</th>
          </tr>
        </thead>
        <tbody id="stockTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Popup -->
  <div class="popup-bg" id="popupBg">
    <div class="popup">
      <h3>Add New Part</h3>
      <input type="text" id="partno" placeholder="Part Number" />
      <input type="text" id="pname" placeholder="Part Name" />
      <input type="text" id="vehicle" placeholder="Vehicle" />
      <input type="number" id="stock" placeholder="Stock Amount" />
      <input type="number" id="buy" placeholder="Buy Price" />
      <input type="number" id="sell" placeholder="Sell Price" />

      <div class="btn-row">
        <button class="btn" onclick="addItem()">Add Item</button>
        <button class="btn cancel-btn" onclick="closePopup()">Cancel</button>
      </div>
    </div>
  </div>

<!-- Firebase Script -->
<script type="module">

  // Import Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, set, push, get, child, remove }
    from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyBN9LWPP0tebZiCtXMAKatKivb5lX0g1_g",
    authDomain: "shopstock-d304a.firebaseapp.com",
    databaseURL: "https://shopstock-d304a-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "shopstock-d304a",
    storageBucket: "shopstock-d304a.firebasestorage.app",
    messagingSenderId: "82450149368",
    appId: "1:82450149368:web:3772ec3a4d96d8c1ecf00d",
    measurementId: "G-0VWDCPSVSX"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ---------- Open + Close Popup ----------
  window.openPopup = () => document.getElementById('popupBg').style.display = 'flex';
  window.closePopup = () => document.getElementById('popupBg').style.display = 'none';

  // ---------- Load Stock ----------
  function loadStock() {
    const dbRef = ref(db, "stock");

    get(dbRef).then(snapshot => {
      if (snapshot.exists()) {
        const list = Object.values(snapshot.val());
        displayStock(list);
      } else {
        displayStock([]);
      }
    });
  }

  loadStock(); // Load on start

  // ---------- Add Item ----------
  window.addItem = function () {
    const item = {
      id: Date.now(),
      partno: partno.value,
      name: pname.value,
      vehicle: vehicle.value,
      stock: stock.value,
      buy: buy.value,
      sell: sell.value
    };

    const newRef = push(ref(db, "stock"));
    set(newRef, item).then(() => {
      closePopup();
      loadStock();
      document.querySelectorAll('.popup input').forEach(i => i.value = "");
    });
  };

  // ---------- Delete Item ----------
  window.deleteItem = function (id) {
    const dbRef = ref(db, "stock");

    get(dbRef).then(snapshot => {
      if (!snapshot.exists()) return;

      const data = snapshot.val();
      const key = Object.keys(data).find(k => data[k].id === id);

      if (key) {
        remove(child(dbRef, key)).then(() => loadStock());
      }
    });
  };

  // ---------- Display Stock ----------
  function displayStock(data) {
    const table = document.getElementById("stockTable");
    table.innerHTML = "";

    data.forEach(item => {
      table.innerHTML += `
      <tr>
        <td>${item.partno}</td>
        <td>${item.name}</td>
        <td>${item.vehicle}</td>
        <td>${item.stock}</td>
        <td>${item.buy}</td>
        <td>${item.sell}</td>
        <td>
            <button onclick="deleteItem('${item.partno}')" style="background:none; border:none; cursor:pointer;">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23dc3545'%3E%3Cpath d='M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-9l-1 1H5v2h14V4z'/%3E%3C/svg%3E" width="20"/>
            </button>
            </td>
      </tr>`;
    });
  }

  // ---------- Search Filter ----------
  window.filterStock = function () {
    const text = searchInput.value.toLowerCase();

    const dbRef = ref(db, "stock");

    get(dbRef).then(snapshot => {
      if (!snapshot.exists()) return;

      const all = Object.values(snapshot.val());
      const filtered = all.filter(i =>
        i.name.toLowerCase().includes(text) ||
        i.partno.toLowerCase().includes(text)
      );

      displayStock(filtered);
    });
  };

</script>

</body>
</html>